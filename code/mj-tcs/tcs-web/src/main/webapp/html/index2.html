<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>MJ TCS Client</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" type="text/css" href="../css/animate.css"/>
        <!--<link rel="stylesheet" href="../css/font-awesome/css/font-awesome.min.css"/>-->
        <style>
            body > div > div {
                margin: 10px;
                padding: 5px;
                border: dashed 1px #777;
            }
        </style>

        <script src="../js/jquery-1.11.3.js"></script>

        <script src="../plugin/noty/packaged/jquery.noty.packaged.min.js"></script>

        <script src="../plugin/sockjs/sockjs.js"></script>
        <script src="../plugin/stomp/stomp.min.js"></script>
        <script defer="defer" type="text/javascript">
            var URL = "http://" + location.host +"/stomp";
            var ACTIONS = {
                           // Scene
                           SCENE_PROFILE :"SCENE_PROFILE",
                           SCENE_CREATE :"SCENE_CREATE",
                           SCENE_FIND :"SCENE_FIND",
                           SCENE_DELETE :"SCENE_DELETE",
                           SCENE_START :"SCENE_START",
                           SCENE_STOP :"SCENE_STOP",
                           SCENE_SPECIFIC_PROFILE :"SCENE_SPECIFIC_PROFILE",
                           // Transport Order
                           TO_NEW: "TO_NEW",
                           TO_WITHDRAW: "TO_WITHDRAW",
                           // Vehicle
                           VEHICLE_PROFILE: "VEHICLE_PROFILE",
                           VEHICLE_ADAPTER_ATTACH: "VEHICLE_ADAPTER_ATTACH",
                           VEHICLE_DISPATCH: "VEHICLE_DISPATCH",
                           VEHICLE_STOP_TO: "VEHICLE_STOP_TO",
                           VEHICLE_PARK: "VEHICLE_PARK"
            };
            var REQ_UUID = uuid();
//            var wsUrl = "ws://localhost:8080/tcs-web/tcs-web";
            var stompClient = null;
            var req_action = null;
            var adapterMap = new Map();
            var subscriberMap = new Map();// sceneId -> subscriberLists

            function sceneIdChange() {
                var sceneId = $("#findSceneId").val();
                $("#vehicleSceneId").html("<b>SceneID: </b>" + sceneId);
                $("#transportSceneId1").html("<b>SceneID: </b>" + sceneId);
                $("#transportSceneId2").html("<b>SceneID: </b>" + sceneId);

                // update subscribers for the new scene
                if (subscriberMap.has(sceneId)) {
                    var prevSubscribers = subscriberMap.get(sceneId);
                    for (var i = 0; i < prevSubscribers.length; i++) {
                        prevSubscribers[i].unsubscribe();
                    }
                    subscriberMap.clear();
                }

                // add new subscribers
                var transportSubscriber = stompClient.subscribe("/topic/status/scenes/" + sceneId+"/torders",
                        function(message) {
//                            var response = JSON.parse(message.body);
                            console.log("++++++++++++++++");
//                            console.log(message.body);

                            document.getElementById('transportStatus').innerHTML = "<b>TransportOrder:</b><br>" + message.body;
                        });

                var vehicleSubscriber = stompClient.subscribe("/topic/status/scenes/" + sceneId+"/vehicles",
                        function(message) {
//                            var response = JSON.parse(message.body);
                            console.log("---------------");
//                            console.log(message.body);
                            document.getElementById("vehicleStatus").innerHTML = "<b>VehicleStatus:</b><br>" + message.body;
                        });

                subscriberMap.set(sceneId, [transportSubscriber, vehicleSubscriber]);
            };

            function setConnected(connected) {
                document.getElementById('connect').disabled = connected;
                document.getElementById('disconnect').disabled = !connected;
            }

            function connect() {
                var socket = new SockJS(URL);
                stompClient = Stomp.over(socket);

                stompClient.heartbeat.outgoing = 10000; // client will send heartbeats every 10000ms
                stompClient.heartbeat.incoming = 0; // client does not want to receive heartbeats from the server

                stompClient.connect({}, function(frame) {
                    setConnected(true);
                    console.log('Connected: ' + frame);

                    stompClient.subscribe("/user/topic/actions/response", function(message) {
                        var response = JSON.parse(message.body);
                        document.getElementById('response').innerHTML = "<b>Response:</b><br><br>" + message.body;

                        if (response.uuid == REQ_UUID) {
                            var status = response.status_code.toLocaleLowerCase();
                            var message = '<h6>' + response.status_message + '</h6>' + JSON.stringify(response.body);
                            generate(status, message);

                            $('#content').html("<b>Status Code:</b>&nbsp" + response.status_code + "<br>" +
                                    "<b>Status Message:</b>&nbsp" + response.status_message + "<br>" +
//                                        "<b>Action Code:</b>&nbsp" + response.action_code + "<br><br>" +
                                    "<b>Body:</b>" + JSON.stringify(response.body));
                        } else if (response.uuid == (REQ_UUID + "_PROFILE")) {
                            var contentList = response.body;
                            var currentVehicleUUID = $('#vehicleUUID').val();
                            // collect adapters for all vehicles
                            var currentVehicleIndex = -1;
                            adapterMap.clear();
                            for(var i=0; i < contentList.length; i++) {
                                adapterMap.set(contentList[i].uuid, contentList[i].adapters);
                                if (contentList[i].uuid == currentVehicleUUID) {
                                    currentVehicleIndex = i;
                                }
                            }

                            var domVehicleAdapters = $("#vehicleAdapters");
                            domVehicleAdapters.empty();
                            domVehicleAdapters.append("<option value=''></option>");

                            // add adapter options for the specified vehicle
                            if (adapterMap.has(currentVehicleUUID)) {
                                var adapters = adapterMap.get(currentVehicleUUID);
                                for (var i=0; i<adapters.length; i++) {
                                    domVehicleAdapters.append("<option value='" + adapters[i] + "'>"  + adapters[i] +"</option>");
                                }
                                // select the default value
                                domVehicleAdapters.val(contentList[currentVehicleIndex].adapter);

                                // update Enable checkbox
                                $("#enableAdapter").prop("checked", contentList[currentVehicleIndex].enable == "true");

                                // update PointUUID
                                $("#vehiclePointUUID").val(contentList[currentVehicleIndex].position_uuid);
                            }

                        } else {
                                generate('error', 'Received irrelevant message ! <br><p>' + message.body + '</p>')
                        }
                    });

                    stompClient.subscribe("/user/queue/errors", function(message) {
                        generate("error", message.body);
                    });

                });
            }

            function disconnect() {
                if (stompClient != null) {
                    stompClient.unsubscribe();
                    stompClient.disconnect();
                }
                setConnected(false);
                console.log("Disconnected");
            }

            function clearResponse() {
                document.getElementById("response").innerText = "";
            }

            function getScenesProfile() {
                fireAction(ACTIONS.SCENE_PROFILE);
            }

            function createScene() {
                var newName = $('#newSceneName').val();
                var body = {"id":null,"version":null,"name":newName,"properties":[{"name":"key","value":"value"}],"UUID":"scenedto-d5c1b489-83df-437a-9201-c4dc1360a76d",
                            "points":[{"id":null,"version":null,"name":"test_point_0","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[{"id":null,"name":"test_link_6317","UUID":"locationlinkdto-8ba1a9e7-79ad-45ba-8b35-e31b5f0c42e2"}],"UUID":"pointdto-19c7f292-17ef-4376-97e0-e192b07e9dd4","position":{"x":515,"y":451,"z":0},"display_position_x":515,"display_position_y":451,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[],"outgoing_paths":[{"id":null,"name":"test_path_0","UUID":"pathdto-151681fc-0f6d-493f-a4a0-602dd819ff72"}]},{"id":null,"version":null,"name":"test_point_1","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-674a9851-07d2-4e35-947a-fa29cb560c27","position":{"x":147,"y":648,"z":0},"display_position_x":147,"display_position_y":648,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_0","UUID":"pathdto-151681fc-0f6d-493f-a4a0-602dd819ff72"}],"outgoing_paths":[{"id":null,"name":"test_path_1","UUID":"pathdto-b16a4f6a-1302-48ca-8570-1b1137003e29"}]},{"id":null,"version":null,"name":"test_point_2","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-9c54c5bb-0ea3-47bd-90c3-a80eb40a67da","position":{"x":358,"y":433,"z":0},"display_position_x":358,"display_position_y":433,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_1","UUID":"pathdto-b16a4f6a-1302-48ca-8570-1b1137003e29"}],"outgoing_paths":[{"id":null,"name":"test_path_2","UUID":"pathdto-e75207c5-04dc-44d1-9744-dea07e09d09d"}]},{"id":null,"version":null,"name":"test_point_3","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-a7e7607f-a580-414e-9506-dd413ccb809b","position":{"x":533,"y":386,"z":0},"display_position_x":533,"display_position_y":386,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_2","UUID":"pathdto-e75207c5-04dc-44d1-9744-dea07e09d09d"}],"outgoing_paths":[{"id":null,"name":"test_path_3","UUID":"pathdto-d332d1d8-2104-4847-b206-bc9759d11398"}]},{"id":null,"version":null,"name":"test_point_4","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-3d9a04cc-cb9f-4698-aecf-2b77018bbaeb","position":{"x":994,"y":779,"z":0},"display_position_x":994,"display_position_y":779,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_3","UUID":"pathdto-d332d1d8-2104-4847-b206-bc9759d11398"}],"outgoing_paths":[{"id":null,"name":"test_path_4","UUID":"pathdto-4a6c0928-c4f4-41e7-b936-c3475616fcea"}]},{"id":null,"version":null,"name":"test_point_5","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-060a7625-ece0-4d6d-9e58-b92d9c9dcdfb","position":{"x":170,"y":920,"z":0},"display_position_x":170,"display_position_y":920,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_4","UUID":"pathdto-4a6c0928-c4f4-41e7-b936-c3475616fcea"}],"outgoing_paths":[{"id":null,"name":"test_path_5","UUID":"pathdto-3dbb85ce-742b-403b-ac66-a613b56dd6a4"}]},{"id":null,"version":null,"name":"test_point_6","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-f868327f-6205-449a-b6a6-51fc102d37db","position":{"x":660,"y":559,"z":0},"display_position_x":660,"display_position_y":559,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_5","UUID":"pathdto-3dbb85ce-742b-403b-ac66-a613b56dd6a4"}],"outgoing_paths":[{"id":null,"name":"test_path_6","UUID":"pathdto-bc088ce5-32a9-4b36-a5fe-83ecedde4464"}]},{"id":null,"version":null,"name":"test_point_7","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-2c321269-3d2e-425a-b83e-4d4f8173f1ba","position":{"x":34,"y":513,"z":0},"display_position_x":34,"display_position_y":513,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_6","UUID":"pathdto-bc088ce5-32a9-4b36-a5fe-83ecedde4464"}],"outgoing_paths":[{"id":null,"name":"test_path_7","UUID":"pathdto-21765a78-153a-4bb1-ac09-d45b173e65c8"}]},{"id":null,"version":null,"name":"test_point_8","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-5dc49133-bc1b-44c0-a01a-f0f933e649df","position":{"x":383,"y":284,"z":0},"display_position_x":383,"display_position_y":284,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_7","UUID":"pathdto-21765a78-153a-4bb1-ac09-d45b173e65c8"}],"outgoing_paths":[{"id":null,"name":"test_path_8","UUID":"pathdto-0ecdcfe9-9ea7-4edb-8c8f-cf98b3ea7ae4"}]},{"id":null,"version":null,"name":"test_point_9","properties":[{"name":"key","value":"value"}],"vehicle_orientation_angle":0.0,"type":"HALT_POSITION","attached_links":[],"UUID":"pointdto-089f23fd-b0bb-4813-b009-1a22949d86be","position":{"x":231,"y":935,"z":0},"display_position_x":231,"display_position_y":935,"label_offset_x":0,"label_offset_y":20,"incoming_paths":[{"id":null,"name":"test_path_8","UUID":"pathdto-0ecdcfe9-9ea7-4edb-8c8f-cf98b3ea7ae4"}],"outgoing_paths":[]}],
                            "paths":[{"id":null,"version":null,"name":"test_path_0","properties":[{"name":"key","value":"value"}],"control_points":[],"length":508,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-151681fc-0f6d-493f-a4a0-602dd819ff72","source_point":{"id":null,"name":"test_point_0","UUID":"pointdto-19c7f292-17ef-4376-97e0-e192b07e9dd4"},"destination_point":{"id":null,"name":"test_point_1","UUID":"pointdto-674a9851-07d2-4e35-947a-fa29cb560c27"}},{"id":null,"version":null,"name":"test_path_1","properties":[{"name":"key","value":"value"}],"control_points":[],"length":600,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-b16a4f6a-1302-48ca-8570-1b1137003e29","source_point":{"id":null,"name":"test_point_1","UUID":"pointdto-674a9851-07d2-4e35-947a-fa29cb560c27"},"destination_point":{"id":null,"name":"test_point_2","UUID":"pointdto-9c54c5bb-0ea3-47bd-90c3-a80eb40a67da"}},{"id":null,"version":null,"name":"test_path_2","properties":[{"name":"key","value":"value"}],"control_points":[],"length":399,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-e75207c5-04dc-44d1-9744-dea07e09d09d","source_point":{"id":null,"name":"test_point_2","UUID":"pointdto-9c54c5bb-0ea3-47bd-90c3-a80eb40a67da"},"destination_point":{"id":null,"name":"test_point_3","UUID":"pointdto-a7e7607f-a580-414e-9506-dd413ccb809b"}},{"id":null,"version":null,"name":"test_path_3","properties":[{"name":"key","value":"value"}],"control_points":[],"length":293,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-d332d1d8-2104-4847-b206-bc9759d11398","source_point":{"id":null,"name":"test_point_3","UUID":"pointdto-a7e7607f-a580-414e-9506-dd413ccb809b"},"destination_point":{"id":null,"name":"test_point_4","UUID":"pointdto-3d9a04cc-cb9f-4698-aecf-2b77018bbaeb"}},{"id":null,"version":null,"name":"test_path_4","properties":[{"name":"key","value":"value"}],"control_points":[],"length":896,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-4a6c0928-c4f4-41e7-b936-c3475616fcea","source_point":{"id":null,"name":"test_point_4","UUID":"pointdto-3d9a04cc-cb9f-4698-aecf-2b77018bbaeb"},"destination_point":{"id":null,"name":"test_point_5","UUID":"pointdto-060a7625-ece0-4d6d-9e58-b92d9c9dcdfb"}},{"id":null,"version":null,"name":"test_path_5","properties":[{"name":"key","value":"value"}],"control_points":[],"length":878,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-3dbb85ce-742b-403b-ac66-a613b56dd6a4","source_point":{"id":null,"name":"test_point_5","UUID":"pointdto-060a7625-ece0-4d6d-9e58-b92d9c9dcdfb"},"destination_point":{"id":null,"name":"test_point_6","UUID":"pointdto-f868327f-6205-449a-b6a6-51fc102d37db"}},{"id":null,"version":null,"name":"test_path_6","properties":[{"name":"key","value":"value"}],"control_points":[],"length":486,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-bc088ce5-32a9-4b36-a5fe-83ecedde4464","source_point":{"id":null,"name":"test_point_6","UUID":"pointdto-f868327f-6205-449a-b6a6-51fc102d37db"},"destination_point":{"id":null,"name":"test_point_7","UUID":"pointdto-2c321269-3d2e-425a-b83e-4d4f8173f1ba"}},{"id":null,"version":null,"name":"test_path_7","properties":[{"name":"key","value":"value"}],"control_points":[],"length":316,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-21765a78-153a-4bb1-ac09-d45b173e65c8","source_point":{"id":null,"name":"test_point_7","UUID":"pointdto-2c321269-3d2e-425a-b83e-4d4f8173f1ba"},"destination_point":{"id":null,"name":"test_point_8","UUID":"pointdto-5dc49133-bc1b-44c0-a01a-f0f933e649df"}},{"id":null,"version":null,"name":"test_path_8","properties":[{"name":"key","value":"value"}],"control_points":[],"length":887,"routing_cost":1,"max_velocity":1000,"max_reverse_velocity":1000,"locked":false,"UUID":"pathdto-0ecdcfe9-9ea7-4edb-8c8f-cf98b3ea7ae4","source_point":{"id":null,"name":"test_point_8","UUID":"pointdto-5dc49133-bc1b-44c0-a01a-f0f933e649df"},"destination_point":{"id":null,"name":"test_point_9","UUID":"pointdto-089f23fd-b0bb-4813-b009-1a22949d86be"}}],
                            "locations":[{"id":null,"version":null,"name":"test_location_6317","properties":[{"name":"key","value":"value"}],"attached_links":[{"id":null,"version":null,"name":"test_link_6317","allowed_operations":[],"UUID":"locationlinkdto-8ba1a9e7-79ad-45ba-8b35-e31b5f0c42e2","point":{"id":null,"name":"test_point_0","UUID":"pointdto-19c7f292-17ef-4376-97e0-e192b07e9dd4"}}],"UUID":"locationdto-af27c91b-604d-4322-866e-06e7aeba8831","position":{"x":100,"y":100,"z":0},"location_type":{"id":null,"name":"test_lt_1789","UUID":"locationtypedto-f999959b-e161-4da8-b754-87181ec550db"},"display_position_x":100,"display_position_y":100,"label_offset_x":0,"label_offset_y":20}],
                            "location_types":[{"id":null,"version":null,"name":"test_lt_1789","properties":[{"name":"key","value":"value"}],"allowed_operations":["Puts in storage","Stock removal"],"UUID":"locationtypedto-f999959b-e161-4da8-b754-87181ec550db"}],
                            "blocks":[{"id":null,"version":null,"name":"test_block_2437","properties":[{"name":"key","value":"value"}],"members":[{"UUID":"pointdto-19c7f292-17ef-4376-97e0-e192b07e9dd4"},{"UUID":"pointdto-674a9851-07d2-4e35-947a-fa29cb560c27"},{"UUID":"pathdto-151681fc-0f6d-493f-a4a0-602dd819ff72"},{"UUID":"locationdto-af27c91b-604d-4322-866e-06e7aeba8831"}],"UUID":"blockdto-011c6df9-04b8-4f5d-8f79-58a5beb93999"}],
                            "static_routes":[{"id":null,"version":null,"name":"test_static_route_455","properties":[],"hops":[{"id":null,"name":"test_point_0","UUID":"pointdto-19c7f292-17ef-4376-97e0-e192b07e9dd4"},{"id":null,"name":"test_point_1","UUID":"pointdto-674a9851-07d2-4e35-947a-fa29cb560c27"}],"UUID":"staticroutedto-c5cf6b7f-9b0e-47ca-87bd-e398464e5713"}],
                            "vehicles":[{"id":null,"version":null,"name":"test_vehicle_4475","properties":[],"length":1000.0,"energy_level":80.0,"energy_level_critical":30.0,"energy_level_good":80.0,"recharge_operation":"RECHARGE","max_velocity":100.0,"max_reverse_velocity":100.0,"initial_point":null,"orientation_angle":0.0,"UUID":"vehicledto-157dd159-33ff-49fa-af4b-44c572470353","precise_position":null},{"id":null,"version":null,"name":"test_vehicle_4476","properties":[],"length":1000.0,"energy_level":80.0,"energy_level_critical":30.0,"energy_level_good":80.0,"recharge_operation":"RECHARGE","max_velocity":100.0,"max_reverse_velocity":100.0,"initial_point":null,"orientation_angle":0.0,"UUID":"vehicledto-157dd159-33ff-49fa-af4b-44c572470354","precise_position":null},{"id":null,"version":null,"name":"test_vehicle_4477","properties":[],"length":1000.0,"energy_level":80.0,"energy_level_critical":30.0,"energy_level_good":80.0,"recharge_operation":"RECHARGE","max_velocity":100.0,"max_reverse_velocity":100.0,"initial_point":null,"orientation_angle":0.0,"UUID":"vehicledto-157dd159-33ff-49fa-af4b-44c572470355","precise_position":null}],
                            "updated_at":"2016-01-17 09:44:27"};

                fireAction(ACTIONS.SCENE_CREATE, body);
            }

            function getVehicleProfile() {
                var request = {
                    "uuid":REQ_UUID + "_PROFILE", // SPECIAL !!!
                    "action_code":ACTIONS.VEHICLE_PROFILE,
                    "body": {}
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/vehicles/request", {},
                        JSON.stringify(request));
            }

            function attachAdapter() {
                var request = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.VEHICLE_ADAPTER_ATTACH,
                    "body": [{
                        "vehicle_uuid": $("#vehicleUUID").val(),
                        "adapter_name": $("#vehicleAdapters").val(),
                        "initial_position_uuid": $("#vehiclePointUUID").val(),
                        "enable": $("#enableAdapter").prop("checked")
                    }]
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/vehicles/request", {},
                        JSON.stringify(request));
            }

            function dispatchVehicle() {
                var request = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.VEHICLE_DISPATCH,
                    "body": $("#vehicleUUID").val()
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/vehicles/request", {},
                        JSON.stringify(request));
            }

            function parkVehicle() {
                var request = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.VEHICLE_PARK,
                    "body": $("#vehicleUUID").val()
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/vehicles/request", {},
                        JSON.stringify(request));
            }

            function stopVehicle() {
                var request = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.VEHICLE_STOP_TO,
                    "body": {
                        "uuid":$("#vehicleUUID").val(),
                        "disable_vehicle":$("#disableVehicle").prop("checked")
                    }
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/vehicles/request", {},
                        JSON.stringify(request));
            }

            function createTransport() {

                var transport = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.TO_NEW,
                    "body":{
                        "uuid":REQ_UUID,
                        "deadline":null,
                        "intended_vehicle":null,
                        "destinations":[
                            {
                                "location_uuid":$("#locationName1").val(),
                                "operation":$("#operation1").val()
                            }
                        ],
                        "dependencies":[]
                    }
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/torders/request", {},
                        JSON.stringify(transport));
            }

            function withdrawTransport() {

                var transportWithdraw = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.TO_WITHDRAW,
                    "body":{
                        "uuid":$("#transportOrderUUID").val(),
                        "force":$("#forceWithdraw").prop("checked"),
                        "disable_vehicle":$("#disableVehicle").prop("checked")
                    }
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/torders/request", {},
                        JSON.stringify(transportWithdraw));
            }

            function getScene() {
                fireAction(ACTIONS.SCENE_FIND, Number($("#findSceneId").val()));
            }

            function getSceneProfile() {

                var sceneProfile = {
                    "uuid":REQ_UUID,
                    "action_code":ACTIONS.SCENE_SPECIFIC_PROFILE,
                    "body":{}
                };

                stompClient.send("/app/topic/actions/scenes/" + Number($("#findSceneId").val()) + "/request", {},
                        JSON.stringify(sceneProfile));
            }

            function deleteScene() {
                fireAction(ACTIONS.SCENE_DELETE, Number($("#findSceneId").val()));
            }

            function startScene() {
                fireAction(ACTIONS.SCENE_START, Number($("#findSceneId").val()));
            }

            function stopScene() {
                fireAction(ACTIONS.SCENE_STOP, Number($("#findSceneId").val()));
            }

            function fireAction(action, body) {
                stompClient.send("/app/topic/actions/request", {},
                        JSON.stringify({uuid:REQ_UUID,action_code:action,body:body}));
            }

            function uuid() {
                var s = [];
                var hexDigits = "0123456789abcdef";
                for (var i = 0; i < 36; i++) {
                    s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
                }
                s[14] = "4";  // bits 12-15 of the time_hi_and_version field to 0010
                s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01
                s[8] = s[13] = s[18] = s[23] = "-";

                var uuid = s.join("");
                return uuid;
            }

            /**
             *
             * @param type
             *        alert, warning, success, error, information
             * @param text
             *
             */
            function generate(type, text) {
                // Refer to: http://www.yeahzan.com/fa/facss.html
                var icon_style = "fa-info-circle";
                switch (type) {
                    case 'alert':
                        icon_style = "fa-flash";
                        break;
                    case 'warning':
                        icon_style = "fa-warning";
                        break;
                    case 'success':
                        icon_style = "fa-heart";
                        break;
                    case 'error':
                        icon_style = "fa-minus";
                        break;
                    case 'information':
                        icon_style = "fa-info-circle";
                        break;
                }

                var new_text = '<div class="activity-item"> <i class="fa '
                        + icon_style
                        + '"></i>'
                        + '<div class="activity">'
                        + text
                        + '</div> </div>';

                var n = noty({
                    text        : new_text,
                    type        : type, // 消息类型
                    dismissQueue: true, // 使用序列
                    layout      : 'bottomRight', // 显示的位置
                    theme       : 'relax', // 使用的主题
                    template    : '<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>',
                    maxVisible  : 10,
                    modal: false,
                    maxVisible: 5, // 可以设置最多显示多少个通知消息
                    killer: false, // 在显示这个noty之前，将所有的noty关掉
                    closeWith: ['click'], // 关闭的方式，默认是click['click', 'button', 'hover']
                    killer: false, // 在显示这个noty之前，将所有的noty关掉
                    timeout     : 60000, // 60 seconds fade out
                    animation   : {
                        open  : 'animated bounceInRight',
                        close : 'animated fadeOut',
                        easing: 'swing',
                        speed : 500
                    },
                    callback: {     // 设置回调函数
                        onShow: function() {},
                        afterShow: function() {},
                        onClose: function() {},
                        afterClose: function() {}
                    },
                    buttons: false // 定义一个按钮数组
                });
                console.log('html: ' + n.options.uuid);
            }

            // TESTING ONLY !!!
//            // notification body's can be any html string or just string
//            var notification_html = [];
//            notification_html[0] = 'There are <a href="#">6 new tasks</a> waiting for you. Don\'t forget! <span>About 3 hours ago</span>',
//            notification_html[1] = 'Mail server was updated. See <a href="#">changelog</a> <span>About 2 hours ago</span>',
//            notification_html[2] = 'Your <a href="#">latest post</a> was liked by <a href="#">Audrey Mall</a> <span>35 minutes ago</span>',
//            notification_html[3] = '<a href="#">Eugene</a> ordered 2 copies of <a href="#">OEM license</a> <span>14 minutes ago</span>';
//
//            function generateAll() {
//                generate('warning', notification_html[0]);
//                generate('error', notification_html[1]);
//                generate('information', notification_html[2]);
//                generate('success', notification_html[3]);
////            generate('notification');
////            generate('success');
//            }
//
//            $(document).ready(function () {
//
//                setTimeout(function() {
//                    generateAll();
//                }, 500);
//
//            });
        </script>
    </head>
    <body>
        <div>
            <div>
                <button id="connect" onclick="connect();">Connect</button>
                <button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
                <button id="clear" onclick="clearResponse();">Clear Content</button>
            </div>
            <div>
                <b>New Scene Name:</b>
                <input id="newSceneName" type="text" name="sceneName" value="scene_01" style="width: 80px"/>
                <button id="createScene" style="width: 100px;height: 100%;" onclick="createScene()">Create Scene</button>
            </div>
            <div>
                <button id="sceneProfiles" onclick="getScenesProfile();">Scene Profile</button>
                <b>Scene ID:</b>
                <input id="findSceneId" onkeyup="sceneIdChange()" type="text" name="sceneId" value="" style="width: 30px"/>
                <button id="getScene" style="width: 100px; height: 100%;" onclick="getScene()">Get Scene</button>
                <button id="getSceneProfile" style="width: 150px; height: 100%;" onclick="getSceneProfile()">Get Scene Profile</button>
                <button id="deleteScene" style="width: 100px; height: 100%;" onclick="deleteScene()">Delete Scene</button>
                <button id="startScene" style="width: 100px;height: 100%;" onclick="startScene()">Start Scene</button>
                <button id="stopScene" style="width: 100px;height: 100%;" onclick="stopScene()">Stop Scene</button>
            </div>
            <div>
                <span id="vehicleSceneId"></span>
                <button id="vehicleProfile" style="width: 100px;height: 100%;" onclick="getVehicleProfile()">Vehicle Profile</button>
                <b>Vehicle UUID:</b><input id="vehicleUUID" type="text" name="vehicleUUID" value="" style="width: 250px"/>
                <p>
                    <label>Select Adapter</label>
                    <select id = "vehicleAdapters" style="width: 200px;">
                        <option value = ""></option>
                    </select>
                    <label><input id="enableAdapter" type="checkbox" value="" />Enable</label>
                    <b>PointUUID:</b><input id="vehiclePointUUID" type="text" value="" style="width: 250px;height: 100%;"/>
                    <button id="setAdapter"onclick="attachAdapter()">Set Adapter</button>
                </p>
                <button id="vehicleDispatch" style="width: 150px;height: 100%;" onclick="dispatchVehicle()">Dispatch Vehicle</button>
                <button id="vehiclePark" style="width: 150px;height: 100%;" onclick="parkVehicle()">Park Vehicle</button>
                <button id="vehicleStop" style="width: 150px;height: 100%;" onclick="stopVehicle()">Stop Vehicle</button>
            </div>
            <div>
                <span id="transportSceneId1"></span>
                <b>Location UUID:</b><input id="locationName1" type="text" name="locationName1" value="" style="width: 250px"/>
                <b>Operation:</b><input id="operation1" type="text" name="operation1" value="NOP" style="width: 80px"/>
                <button id="createTransport" style="width: 150px;height: 100%;" onclick="createTransport()">Create Transport</button>
            </div>
            <div>
                <span id="transportSceneId2"></span>
                <b>TransportOrder UUID:</b><input id="transportOrderUUID" type="text" name="transportOrderUUID" value="" style="width: 250px"/>
                <label><input id="disableVehicle" type="checkbox" value="" />Disable Vehicle</label>
                <label><input id="forceWithdraw" type="checkbox" value="" />forceWithdraw</label>
                <button id="withdrawTransport" style="width: 150px;height: 100%;" onclick="withdrawTransport()">Withdraw Transport</button>
            </div>
            <div id="transportStatus" style="height: 80px;">
            </div>
            <div id="vehicleStatus" style="height: 80px">
            </div>
            <div id="response" style="height: 500px;"/>
        </div>

    </body>
</html>
